"""\nBerxel P100Rç›¸æœºPythonæ¥å£\næä¾›ç®€å•æ˜“ç”¨çš„ç›¸æœºæ§åˆ¶API\n\nä½œè€…: Zhuo\næ—¥æœŸ: 2025-10-15\n"""\n\nimport berxel_wrapper\nimport cv2\nimport numpy as np\n\n\nclass BerxelCamera:\n    """Berxel P100Rç›¸æœºå°è£…ç±»"""\n    \n    def __init__(self):\n        self.initialized = False\n        \n    def initialize(self):\n        """åˆå§‹åŒ–ç›¸æœº"""\n        try:\n            berxel_wrapper.init_camera()\n            self.initialized = True\n            print(\"âœ… Berxelç›¸æœºåˆå§‹åŒ–æˆåŠŸ\")\n            return True\n        except Exception as e:\n            print(f\"âŒ ç›¸æœºåˆå§‹åŒ–å¤±è´¥: {str(e)}\")\n            return False\n            \n    def get_frame(self):\n        """è·å–ä¸€å¸§å½©è‰²å›¾åƒ\n        \n        Returns:\n            frame: BGRæ ¼å¼å½©è‰²å›¾ (1920x1080x3), å¤±è´¥è¿”å›None\n        """\n        if not self.initialized:\n            print(\"[WARNING] ç›¸æœºæœªåˆå§‹åŒ–\")\n            return None\n            \n        try:\n            frame = berxel_wrapper.get_frame()\n            if frame is None:\n                return None\n            \n            # ç¡®ä¿è¿”å›BGRæ ¼å¼ä»¥å…¼å®¹OpenCV\n            if frame.shape[2] == 3:\n                return cv2.cvtColor(frame, cv2.COLOR_RGB2BGR)\n            return frame\n            \n        except Exception as e:\n            print(f\"âŒ è·å–å½©è‰²å›¾åƒå¤±è´¥: {str(e)}\")\n            return None\n            \n    def get_depth(self):\n        """è·å–ä¸€å¸§æ·±åº¦å›¾åƒ\n        \n        Returns:\n            depth: æ·±åº¦å›¾ (640x400), å•ä½:æ¯«ç±³, uint16, å¤±è´¥è¿”å›None\n        """\n        if not self.initialized:\n            print(\"[WARNING] ç›¸æœºæœªåˆå§‹åŒ–\")\n            return None\n            \n        try:\n            depth = berxel_wrapper.get_depth()\n            return depth\n            \n        except Exception as e:\n            print(f\"âŒ è·å–æ·±åº¦å›¾åƒå¤±è´¥: {str(e)}\")\n            return None\n    \n    def get_depth_meters(self):\n        """è·å–æ·±åº¦å›¾åƒï¼ˆå•ä½ï¼šç±³ï¼‰\n        \n        Returns:\n            depth: æ·±åº¦å›¾ (640x400), å•ä½:ç±³, float32, å¤±è´¥è¿”å›None\n        """\n        depth_mm = self.get_depth()\n        if depth_mm is None:\n            return None\n        \n        # è½¬æ¢ä¸ºç±³\n        return depth_mm.astype(np.float32) / 1000.0\n            \n    def release(self):\n        """é‡Šæ”¾ç›¸æœºèµ„æº"""\n        if self.initialized:\n            try:\n                berxel_wrapper.release_camera()\n                print(\"âœ… ç›¸æœºèµ„æºå·²é‡Šæ”¾\")\n            except Exception as e:\n                print(f\"âŒ é‡Šæ”¾ç›¸æœºèµ„æºå¤±è´¥: {str(e)}\")\n            finally:\n                self.initialized = False\n\n\ndef main():\n    """æµ‹è¯•ç›¸æœºåŠŸèƒ½"""\n    print(\"=\" * 60)\n    print(\"Berxel P100R ç›¸æœºæµ‹è¯•\")\n    print(\"=\" * 60)\n    \n    # åˆå§‹åŒ–ç›¸æœº\n    camera = BerxelCamera()\n    if not camera.initialize():\n        print(\"\\nâŒ æ— æ³•åˆå§‹åŒ–ç›¸æœºï¼Œé€€å‡º\")\n        return\n    \n    print(\"\\nâœ… ç›¸æœºå·²å°±ç»ª\")\n    print(\"æŒ‰ 'q' é€€å‡º, 'c' æˆªå–å½©è‰²å›¾, 'd' æˆªå–æ·±åº¦å›¾\\n\")\n    \n    color_count = 0\n    depth_count = 0\n    \n    try:\n        while True:\n            # è¯»å–å½©è‰²å›¾\n            color = camera.get_frame()\n            if color is not None:\n                cv2.imshow('P100R Color', color)\n            \n            # è¯»å–æ·±åº¦å›¾\n            depth = camera.get_depth()\n            if depth is not None:\n                # å¯è§†åŒ–æ·±åº¦\n                depth_vis = cv2.applyColorMap(\n                    cv2.normalize(depth, None, 0, 255, cv2.NORM_MINMAX).astype(np.uint8),\n                    cv2.COLORMAP_JET\n                )\n                cv2.imshow('P100R Depth', depth_vis)\n            \n            # æŒ‰é”®å¤„ç†\n            key = cv2.waitKey(1) & 0xFF\n            if key == ord('q'):\n                break\n            elif key == ord('c') and color is not None:\n                color_count += 1\n                filename = f'color_{color_count}.png'\n                cv2.imwrite(filename, color)\n                print(f\"ğŸ“¸ å½©è‰²å›¾ä¿å­˜: {filename}\")\n            elif key == ord('d') and depth is not None:\n                depth_count += 1\n                filename = f'depth_{depth_count}.png'\n                cv2.imwrite(filename, depth_vis)\n                print(f\"ğŸ“¸ æ·±åº¦å›¾ä¿å­˜: {filename}\")\n    \n    except KeyboardInterrupt:\n        print(\"\\n\\nç”¨æˆ·ä¸­æ–­\")\n    \n    finally:\n        camera.release()\n        cv2.destroyAllWindows()\n        print(\"\\nç¨‹åºç»“æŸ\")\n\n\nif __name__ == \"__main__\":\n    main()\n